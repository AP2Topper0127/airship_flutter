name: Release

on:
  push:
    tags:
      - "[0-9]+.[0-9]+.[0-9]+*"
    branches:
      - MOBILE-1320

jobs:
#  analyze:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-java@v1
#        with:
#          java-version: "12.x"
#      - uses: subosito/flutter-action@v1
#        with:
#          channel: "stable"
#      - name: Run CI
#        run: bash ./scripts/run_ci_tasks.sh -z
#  android:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-java@v1
#        with:
#          java-version: "12.x"
#      - uses: subosito/flutter-action@v1
#        with:
#          channel: "stable"
#      - name: Run CI
#        run: bash ./scripts/run_ci_tasks.sh -a
#  ios:
#    runs-on: macos-latest
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-java@v1
#        with:
#          java-version: "12.x"
#      - uses: subosito/flutter-action@v1
#        with:
#          channel: "stable"
#      - name: Run CI
#        run: bash ./scripts/run_ci_tasks.sh -i
  upload-docs:
    runs-on: macos-latest
#    needs: [analyze, android, ios]
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'
      - name: Flutter action
        uses: subosito/flutter-action@v1
        with:
          flutter-version: 'v1.12.13+hotfix.8'
      - run: which flutter
      #- run: export PATH="$PATH:[PATH_TO_FLUTTER_GIT_DIRECTORY]/flutter/bin"
      - name: Install Homebrew
        run: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
      - name: Install dart
        run: |
          brew tap dart-lang/dart
          brew install dart
          brew info dart
      - run: flutter pub get
      - run: export FLUTTER_ROOT=/Users/runner/hostedtoolcache/flutter/1.12.13-hotfix.8-stable/x64/bin/flutter
      - name: Generate documentation
        run: |
          dartdoc
      - name: Download docs tar
        uses: actions/download-artifact@v1
        with:
          name: docs
          path: ./doc/api/
      - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
        with:
          version: "270.0.0"
          service_account_email: ${{ secrets.GCP_SA_EMAIL }}
          service_account_key: ${{ secrets.GCP_SA_KEY }}
#      - name: Slack Notification
#        uses: homoluctus/slatify@master
#        if: always()
#        with:
#          type: ${{ job.status }}
#          job_name: "Uploaded flutter API docs"
#          url: ${{ secrets.MOBILE_SLACK_WEBHOOK }}
#  publish:
#    runs-on: ubuntu-latest
#    needs: [analyze, android, ios]
#    steps:
#      - uses: actions/checkout@v1
#      - name: Publish Dart/Flutter package
#        uses: sakebook/actions-flutter-pub-publisher@v1.2.1
#        with:
#          # Google Account credential JSON
#          credential:  ${{ secrets.PUB_DEV_CREDENTIALS }}
#  finished:
#    runs-on: ubuntu-latest
#    needs: [analyze, android, ios, publish]
#    steps:
#      - name: Slack Notification
#        uses: homoluctus/slatify@master
#        if: always()
#        with:
#          type: ${{ job.status }}
#          job_name: ":raised_hands: Airship Flutter Plugin Released! :raised_hands:"
#          url: ${{ secrets.MOBILE_SLACK_WEBHOOK }}
